

{% extends 'base.html' %}
{% block content %}

<h2 class="mb-4 d-flex align-items-center gap-2">
    üìÖ –°–æ–±—ã—Ç–∏—è –≤ –≥–æ—Ä–æ–¥–µ
</h2>


<form method="get" class="mb-4">
    <div class="row g-2 align-items-end">

        <div class="col-md-6">
            <input
                type="text"
                name="q"
                class="form-control"
                placeholder="–ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π..."
                value="{{ query }}"
            >
        </div>

        <div class="col-md-4">
            <select name="sort" class="form-select">
                <option value="date_desc" {% if sort == "date_desc" %}selected{% endif %}>
                    üìÖ –°–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ
                </option>
                <option value="date_asc" {% if sort == "date_asc" %}selected{% endif %}>
                    üìÖ –°–Ω–∞—á–∞–ª–∞ —Å—Ç–∞—Ä—ã–µ
                </option>
                <option value="title_asc" {% if sort == "title_asc" %}selected{% endif %}>
                    üî§ –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–ê‚Äì–Ø)
                </option>
                <option value="rating_desc" {% if sort == "rating_desc" %}selected{% endif %}>
                    ‚≠ê –ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É (–ª—É—á—à–∏–µ)
                </option>
            </select>
        </div>

        <div class="col-md-2">
            <button class="btn btn-primary w-100">
                üîç –ù–∞–π—Ç–∏
            </button>
        </div>

    </div>
</form>



<!-- –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π -->
{% if events %}
    <div class="row">
        {% for event in events %}
            <div class="col-md-4 mb-4">
                <div class="card h-100 shadow-sm border-0">

                    {% if event.image %}
                        <img src="{{ event.image.url }}"
                             class="card-img-top"
                             style="height: 200px; object-fit: cover;">
                    {% endif %}

                    <div class="card-body d-flex flex-column">

                        <h5 class="card-title">{{ event.title }}</h5>

                        <p class="text-muted small mb-1">
                            {{ event.date }}
                        </p>

                        <!-- –†–µ–π—Ç–∏–Ω–≥ -->
                        <div class="mb-2">
                            {% if event.reviews_count > 0 %}
                                {% for i in "12345" %}
                                    {% if event.average_rating >= forloop.counter %}
                                        ‚≠ê
                                    {% else %}
                                        ‚òÜ
                                    {% endif %}
                                {% endfor %}
                                <small class="text-muted">
                                    ({{ event.average_rating|floatformat:1 }})
                                </small>
                            {% else %}
                                <span class="text-muted">üìù –ù–µ—Ç –æ—Ç–∑—ã–≤–æ–≤</span>
                            {% endif %}
                        </div>


                        <p class="card-text">
                            {{ event.description|truncatechars:100 }}
                        </p>

                        <div class="mt-auto">
                            <a href="{% url 'event_detail' event.id %}"
                               class="btn btn-primary w-100">
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </a>
                        </div>

                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    {% if query %}
        <p class="text-muted">
            –ü–æ –∑–∞–ø—Ä–æ—Å—É ¬´<strong>{{ query }}</strong>¬ª –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        </p>
    {% else %}
        <p class="text-muted">
            –°–æ–±—ã—Ç–∏–π –ø–æ–∫–∞ –Ω–µ—Ç
        </p>
    {% endif %}
{% endif %}

{% endblock %}
