{% extends 'base.html' %}

{% block content %}

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="{% url 'event_list' %}">–°–æ–±—ã—Ç–∏—è</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            {{ event.title }}
        </li>
    </ol>
</nav>

<a href="{% url 'event_list' %}" class="btn btn-outline-secondary mb-4">
    ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–æ–±—ã—Ç–∏—è–º
</a>

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–±—ã—Ç–∏–∏ -->
<div class="mb-4">
    <h2>{{ event.title }}</h2>

    {% if event.image %}
        <img src="{{ event.image.url }}" class="img-fluid rounded mb-3">
    {% endif %}

    <p class="text-muted">{{ event.date }}</p>
    <p>{{ event.description }}</p>
</div>

<hr>

<!-- –†–µ–π—Ç–∏–Ω–≥ -->
<h4>
    –†–µ–π—Ç–∏–Ω–≥:
    {% for i in "12345" %}
        {% if event.average_rating >= forloop.counter %}
            ‚≠ê
        {% else %}
            ‚òÜ
        {% endif %}
    {% endfor %}
    <small class="text-muted">
        ({{ event.average_rating|floatformat:1 }}/5)
    </small>
</h4>

<hr>

<!-- –û—Ç–∑—ã–≤—ã -->
<h4>–û—Ç–∑—ã–≤—ã</h4>

{% if reviews %}
    {% for review in reviews %}
        <div class="card mb-3">
            <div class="card-body">
                <strong>{{ review.user.username }}</strong>

                <div class="mb-2">
                    {% for i in "12345" %}
                        {% if forloop.counter <= review.rating %}
                            ‚≠ê
                        {% else %}
                            ‚òÜ
                        {% endif %}
                    {% endfor %}
                </div>

                <p>{{ review.text }}</p>

                <small class="text-muted">
                    {{ review.created_at|date:"d.m.Y H:i" }}
                </small>

                {% if user == review.user %}
                    <div class="mt-3 d-flex gap-2">
                        <a href="{% url 'review_edit' review.id %}"
                           class="btn btn-sm btn-outline-primary">
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </a>

                        <form method="post"
                              action="{% url 'review_delete' review.id %}">
                            {% csrf_token %}
                            <button class="btn btn-sm btn-outline-danger"
                                    onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤?')">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>
    {% endfor %}
{% else %}
    <p class="text-muted">–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>
{% endif %}

<hr>

<!-- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ + —Ñ–æ—Ä–º–∞ –æ—Ç–∑—ã–≤–∞ -->
{% if user.is_authenticated %}

    <a href="{% url 'toggle_favorite' event.id %}"
       class="btn {% if is_favorite %}btn-danger{% else %}btn-outline-danger{% endif %} mb-3">
        {% if is_favorite %}
            ‚ù§Ô∏è –í –∏–∑–±—Ä–∞–Ω–Ω–æ–º
        {% else %}
            ü§ç –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
        {% endif %}
    </a>

    {% if not user_review %}
        <h5>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</h5>

        <form method="post">
            {% csrf_token %}

            <div class="mb-3">
                <label class="form-label">–û—Ü–µ–Ω–∫–∞:</label><br>

                <div class="star-rating">
                    {% for i in "54321" %}
                        <input
                            type="radio"
                            name="rating"
                            id="star{{ i }}"
                            value="{{ i }}"
                        >
                        <label for="star{{ i }}">‚òÖ</label>
                    {% endfor %}
                </div>
            </div>

            <div class="mb-3">
                {{ form.text }}
            </div>

            <button class="btn btn-primary">
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
        </form>
    {% else %}
        <p class="text-muted">
            –í—ã —É–∂–µ –æ—Å—Ç–∞–≤–∏–ª–∏ –æ—Ç–∑—ã–≤ –∫ —ç—Ç–æ–º—É —Å–æ–±—ã—Ç–∏—é.
        </p>
    {% endif %}

{% else %}
    <p class="text-muted">
        –ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤,
        <a href="{% url 'login' %}">–≤–æ–π–¥–∏—Ç–µ</a> –∏–ª–∏
        <a href="{% url 'register' %}">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>.
    </p>
{% endif %}

{% endblock %}
